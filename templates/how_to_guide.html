{% extends "base.html" %}

{% block title %}How To Guide - CPS Energy Tools{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h1>
                        <i class="fas fa-question-circle text-primary me-3"></i>
                        How To Guide
                    </h1>
                    <p class="text-muted">Comprehensive documentation and usage instructions for CPS Energy Tools</p>
                </div>
                <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-2"></i>Back to Home
                </a>
            </div>
        </div>
    </div>

    <!-- Table of Contents -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-list me-2"></i>Table of Contents
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <ul class="list-unstyled">
                                <li><a href="#pole-comparison" class="text-decoration-none"><i class="fas fa-balance-scale me-2"></i>Pole Comparison Tool</a></li>
                                <li><a href="#cover-sheet" class="text-decoration-none"><i class="fas fa-file-alt me-2"></i>Cover Sheet Tool</a></li>
                                <li><a href="#spidacalc-qc" class="text-decoration-none"><i class="fas fa-clipboard-check me-2"></i>SPIDAcalc QC Tool</a></li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <ul class="list-unstyled">
                                <li><a href="#mrr-tool" class="text-decoration-none"><i class="fas fa-cogs me-2"></i>MRR Tool</a></li>
                                <li><a href="#file-formats" class="text-decoration-none"><i class="fas fa-file me-2"></i>File Format Specifications</a></li>
                                <li><a href="#troubleshooting" class="text-decoration-none"><i class="fas fa-wrench me-2"></i>Troubleshooting</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pole Comparison Tool -->
    <div class="row mb-5" id="pole-comparison">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="mb-0">
                        <i class="fas fa-balance-scale me-2"></i>Pole Comparison Tool
                    </h3>
                </div>
                <div class="card-body">
                    <h5>Overview</h5>
                    <p>The Pole Comparison Tool allows you to compare pole data between Katapult Excel files and SPIDAcalc JSON files to identify discrepancies and ensure consistency.</p>

                    <h5 class="mt-4">How to Use</h5>
                    <ol>
                        <li>Navigate to the Pole Comparison Tool page</li>
                        <li>Upload your Katapult Excel file (.xlsx or .xls)</li>
                        <li>Upload your SPIDAcalc JSON file (.json)</li>
                        <li>Set your desired threshold for identifying issues (default is 5%)</li>
                        <li>Click "Process Files" to run the comparison</li>
                        <li>Review the results and export as needed</li>
                    </ol>

                    <h5 class="mt-4">Features</h5>
                    <ul>
                        <li><strong>Automated Pole Matching:</strong> Intelligent matching algorithm pairs poles between systems</li>
                        <li><strong>Loading Discrepancy Detection:</strong> Identifies differences in loading percentages above threshold</li>
                        <li><strong>Specification Comparison:</strong> Compares pole specifications between systems</li>
                        <li><strong>Export Options:</strong> Export all results or issues only to CSV</li>
                        <li><strong>Verification Issues:</strong> Detailed report of missing poles and duplicates</li>
                    </ul>

                    <h5 class="mt-4">Expected File Formats</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Katapult Excel File</h6>
                            <ul class="small">
                                <li>pole_tag or Pole Tag (pole identifier)</li>
                                <li>existing_capacity_% (existing loading)</li>
                                <li>final_passing_capacity_% (final loading)</li>
                                <li>pole_height, pole_class, pole_species (specifications)</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6>SPIDAcalc JSON File</h6>
                            <ul class="small">
                                <li>leads[].locations[].label (pole identifier)</li>
                                <li>leads[].locations[].designs[].structure.pole (specifications)</li>
                                <li>leads[].locations[].designs[].analysis.results (loading analysis)</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cover Sheet Tool -->
    <div class="row mb-5" id="cover-sheet">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="mb-0">
                        <i class="fas fa-file-alt me-2"></i>Cover Sheet Tool
                    </h3>
                </div>
                <div class="card-body">
                    <h5>Overview</h5>
                    <p>The Cover Sheet Tool generates formatted cover sheets from SPIDAcalc files, extracting key project information and pole data for documentation purposes.</p>

                    <h5 class="mt-4">How to Use</h5>
                    <ol>
                        <li>Navigate to the Cover Sheet Tool page</li>
                        <li>Upload your SPIDAcalc JSON file (.json)</li>
                        <li>Click "Generate Cover Sheet" to process the file</li>
                        <li>Review the generated cover sheet data</li>
                        <li>Copy to clipboard or download as text file</li>
                    </ol>

                    <h5 class="mt-4">Features</h5>
                    <ul>
                        <li><strong>Project Information Extraction:</strong> Job number, date, location, city, and engineer</li>
                        <li><strong>Pole Data Summary:</strong> Station IDs, loading percentages, and notes</li>
                        <li><strong>Formatted Output:</strong> Ready-to-use format for documentation</li>
                        <li><strong>Export Options:</strong> Copy to clipboard or download as text file</li>
                        <li><strong>Visual Cards:</strong> Project information displayed in easy-to-read cards</li>
                    </ul>

                    <h5 class="mt-4">Data Extraction</h5>
                    <p>The tool extracts information from specific paths in the SPIDAcalc JSON structure:</p>
                    <ul>
                        <li><strong>Job Number:</strong> Extracted from the 'label' field</li>
                        <li><strong>Date:</strong> Extracted from the 'date' field and formatted as MM/DD/YYYY</li>
                        <li><strong>Location:</strong> Extracted from 'clientData.generalLocation'</li>
                        <li><strong>City:</strong> Extracted from 'address.city'</li>
                        <li><strong>Engineer:</strong> Extracted from the 'engineer' field</li>
                        <li><strong>Pole Data:</strong> Extracted from the 'leads.locations' structure</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- SPIDAcalc QC Tool -->
    <div class="row mb-5" id="spidacalc-qc">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="mb-0">
                        <i class="fas fa-clipboard-check me-2"></i>SPIDAcalc QC Tool
                    </h3>
                </div>
                <div class="card-body">
                    <h5>Overview</h5>
                    <p>The SPIDAcalc QC Tool validates that pole data remains consistent between SPIDAcalc and Katapult after design iterations. It highlights any mismatches so they can be corrected before deliverables are sent.</p>

                    <h5 class="mt-4">How to Use</h5>
                    <ol>
                        <li>Navigate to the <strong>SPIDAcalc QC</strong> page.</li>
                        <li>Upload the <strong>SPIDAcalc JSON</strong> file exported after analysis.</li>
                        <li>Upload the corresponding <strong>Katapult JSON</strong> file.</li>
                        <li>Click <strong>Run QC Checks</strong>.</li>
                        <li>Wait for processing &mdash; a spinner will indicate progress.</li>
                        <li>Review the summarized issues list. Each pole is grouped with the exact discrepancies discovered.</li>
                    </ol>

                    <h5 class="mt-4">Features</h5>
                    <ul>
                        <li><strong>Pole-by-Pole Comparison:</strong> Ensures every pole exists in both systems and flags extras or missing poles.</li>
                        <li><strong>Attribute Validation:</strong> Checks height, class, species, loadings and other critical attributes.</li>
                        <li><strong>Readable Issue Log:</strong> Issues are grouped under each pole for fast triage.</li>
                        <li><strong>Interactive UI:</strong> Drag-and-drop uploads, progress indicator and animated results list.</li>
                    </ul>

                    <h5 class="mt-4">Expected File Structure</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <h6>SPIDAcalc JSON</h6>
                            <ul class="small">
                                <li><code>leads[].locations[].label</code> &ndash; Pole identifier (Station ID)</li>
                                <li><code>leads[].locations[].designs[].analysis.results</code> &ndash; Loadings</li>
                                <li><code>leads[].locations[].designs[].structure.pole</code> &ndash; Specs (height, class, species)</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6>Katapult JSON</h6>
                            <ul class="small">
                                <li><code>structures[].structure_id</code> &ndash; Pole identifier</li>
                                <li><code>structures[].loading_percent_existing</code> &ndash; Existing loading</li>
                                <li><code>structures[].loading_percent_final</code> &ndash; Final loading</li>
                                <li><code>structures[].pole_height / pole_class / pole_species</code> &ndash; Specs</li>
                            </ul>
                        </div>
                    </div>

                    <div class="alert alert-info mt-3">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Tip:</strong> You can copy the issues list or take screenshots for your records before navigating away &mdash; files are cleared from the server when you leave the page.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MRR Tool -->
    <div class="row mb-5" id="mrr-tool">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="mb-0">
                        <i class="fas fa-cogs me-2"></i>MRR Tool
                    </h3>
                </div>
                <div class="card-body">
                    <h5>Overview</h5>
                    <p>The MRR Tool processes Job JSON and GeoJSON files for MRR (Make Ready Report) generation with comprehensive data analysis.</p>

                    <h5 class="mt-4">Two Modes of Operation</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card bg-light">
                                <div class="card-body">
                                    <h6><i class="fas fa-globe me-2"></i>Web Interface</h6>
                                    <ul class="small mb-0">
                                        <li>Basic file validation</li>
                                        <li>Information extraction</li>
                                        <li>Quick processing</li>
                                        <li>Limited functionality</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card bg-light">
                                <div class="card-body">
                                    <h6><i class="fas fa-desktop me-2"></i>Desktop GUI</h6>
                                    <ul class="small mb-0">
                                        <li>Full MRR processing</li>
                                        <li>Excel report generation</li>
                                        <li>Advanced data analysis</li>
                                        <li>Complete feature set</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h5 class="mt-4">How to Use - Web Interface</h5>
                    <ol>
                        <li>Navigate to the MRR Tool page</li>
                        <li>Click "Use Web Interface"</li>
                        <li>Upload your Job JSON file (.json)</li>
                        <li>Upload your GeoJSON file (.json or .geojson)</li>
                        <li>Click "Process Files" to analyze the data</li>
                        <li>Review the extracted information</li>
                    </ol>

                    <h5 class="mt-4">How to Use - Desktop GUI</h5>
                    <ol>
                        <li>Navigate to the MRR Tool page</li>
                        <li>Click "Launch Desktop GUI"</li>
                        <li>Use the desktop application for full processing</li>
                        <li>Browse and select your Job JSON and GeoJSON files</li>
                        <li>Process files to generate Excel reports</li>
                    </ol>

                    <div class="alert alert-warning mt-3">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Important:</strong> For full MRR processing and Excel report generation, use the Desktop GUI. The web interface provides basic file validation only.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- File Format Specifications -->
    <div class="row mb-5" id="file-formats">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="mb-0">
                        <i class="fas fa-file me-2"></i>File Format Specifications
                    </h3>
                </div>
                <div class="card-body">
                    <h5>Supported File Types</h5>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card bg-light">
                                <div class="card-body text-center">
                                    <i class="fas fa-file-excel fa-3x text-success mb-2"></i>
                                    <h6>Excel Files</h6>
                                    <p class="small mb-0">.xlsx, .xls<br>For Katapult data</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card bg-light">
                                <div class="card-body text-center">
                                    <i class="fas fa-file-code fa-3x text-info mb-2"></i>
                                    <h6>JSON Files</h6>
                                    <p class="small mb-0">.json<br>For SPIDAcalc and Job data</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card bg-light">
                                <div class="card-body text-center">
                                    <i class="fas fa-map fa-3x text-warning mb-2"></i>
                                    <h6>GeoJSON Files</h6>
                                    <p class="small mb-0">.json, .geojson<br>For geographic data</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h5 class="mt-4">File Size Limits</h5>
                    <ul>
                        <li>Maximum file size: 50 MB per file</li>
                        <li>Recommended: Keep files under 10 MB for optimal performance</li>
                        <li>Large files may take longer to process</li>
                    </ul>

                    <h5 class="mt-4">Data Quality Guidelines</h5>
                    <ul>
                        <li>Ensure pole IDs are consistent between files</li>
                        <li>Verify that required columns/fields are present</li>
                        <li>Check for special characters that might cause issues</li>
                        <li>Validate JSON files before upload</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Troubleshooting -->
    <div class="row mb-5" id="troubleshooting">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="mb-0">
                        <i class="fas fa-wrench me-2"></i>Troubleshooting
                    </h3>
                </div>
                <div class="card-body">
                    <h5>Common Issues and Solutions</h5>
                    
                    <div class="accordion" id="troubleshootingAccordion">
                        <!-- File Upload Issues -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingOne">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
                                    <i class="fas fa-upload me-2"></i>File Upload Issues
                                </button>
                            </h2>
                            <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#troubleshootingAccordion">
                                <div class="accordion-body">
                                    <strong>Problem:</strong> Files won't upload or upload fails<br>
                                    <strong>Solutions:</strong>
                                    <ul>
                                        <li>Check file size (must be under 50 MB)</li>
                                        <li>Verify file format is supported</li>
                                        <li>Try refreshing the page and uploading again</li>
                                        <li>Check your internet connection</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Processing Errors -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingTwo">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo">
                                    <i class="fas fa-exclamation-triangle me-2"></i>Processing Errors
                                </button>
                            </h2>
                            <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#troubleshootingAccordion">
                                <div class="accordion-body">
                                    <strong>Problem:</strong> Error during file processing<br>
                                    <strong>Solutions:</strong>
                                    <ul>
                                        <li>Verify file format and structure</li>
                                        <li>Check for missing required columns/fields</li>
                                        <li>Ensure data is properly formatted</li>
                                        <li>Try with a smaller sample file first</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- No Results -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingThree">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree">
                                    <i class="fas fa-search me-2"></i>No Results or Empty Output
                                </button>
                            </h2>
                            <div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#troubleshootingAccordion">
                                <div class="accordion-body">
                                    <strong>Problem:</strong> Processing completes but no results shown<br>
                                    <strong>Solutions:</strong>
                                    <ul>
                                        <li>Check if files contain expected data structure</li>
                                        <li>Verify pole IDs match between files</li>
                                        <li>Review file format requirements</li>
                                        <li>Check for data in expected columns/fields</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Performance Issues -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingFour">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour">
                                    <i class="fas fa-clock me-2"></i>Performance Issues
                                </button>
                            </h2>
                            <div id="collapseFour" class="accordion-collapse collapse" data-bs-parent="#troubleshootingAccordion">
                                <div class="accordion-body">
                                    <strong>Problem:</strong> Slow processing or timeouts<br>
                                    <strong>Solutions:</strong>
                                    <ul>
                                        <li>Use smaller files when possible</li>
                                        <li>Close other browser tabs to free memory</li>
                                        <li>Try processing during off-peak hours</li>
                                        <li>Consider using the desktop GUI for large files</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-info mt-4">
                        <i class="fas fa-life-ring me-2"></i>
                        <strong>Need More Help?</strong> If you continue to experience issues, please check the file format specifications and ensure your data meets the requirements.
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Smooth scrolling for anchor links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
    });
});
</script>
{% endblock %} 